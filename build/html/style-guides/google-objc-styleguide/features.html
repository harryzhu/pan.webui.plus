<!DOCTYPE html>
<html class="writer-html5" lang="zh-CN">
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>3.9.5. Cocoa 和 Objective-C 特性 &mdash; AI 模型国内加速  文档</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/theme.css" />
      <link rel="stylesheet" type="text/css" href="../../_static/style.css" />

  
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/translations.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="author" title="关于这些文档" href="../../about.html" />
    <link rel="index" title="索引" href="../../genindex.html" />
    <link rel="search" title="搜索" href="../../search.html" />
    <link rel="next" title="3.9.6. Cocoa 模式" href="patterns.html" />
    <link rel="prev" title="3.9.4. 注释" href="comments.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            AI 模型国内加速
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="搜索文档" aria-label="搜索文档" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="导航菜单">
              <p class="caption" role="heading"><span class="caption-text">目录:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../best-practice/index.html">1. 【AI网盘】人工智能资源汇总</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../stable-diffusion/index.html">2. Stable Diffusion</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">3. 编程语言 风格指南</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../uber_go_cn/index.html">3.1. Uber Go语言规范 中文</a></li>
<li class="toctree-l2"><a class="reference internal" href="../uber_go_style_en.html">3.2. Uber Go Style Guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="../google-python-styleguide/contents.html">3.3. Google: Python 风格指南</a></li>
<li class="toctree-l2"><a class="reference internal" href="../google-shell-styleguide/contents.html">3.4. Google: Shell 风格指南</a></li>
<li class="toctree-l2"><a class="reference internal" href="../google-typescript-styleguide/contents.html">3.5. Google: TypeScript 风格指南</a></li>
<li class="toctree-l2"><a class="reference internal" href="../google-javascript-styleguide/contents.html">3.6. Google: Javascript 风格指南</a></li>
<li class="toctree-l2"><a class="reference internal" href="../google-html-css-styleguide/contents.html">3.7. Google: HTML/CSS 风格指南</a></li>
<li class="toctree-l2"><a class="reference internal" href="../google-cpp-styleguide/contents.html">3.8. Google: C++ 风格指南</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="contents.html">3.9. Google: Objective-C 风格指南</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="index.html">3.9.1. Google Objective-C Style Guide 中文版</a></li>
<li class="toctree-l3"><a class="reference internal" href="spacing.html">3.9.2. 留白和格式</a></li>
<li class="toctree-l3"><a class="reference internal" href="naming.html">3.9.3. 命名</a></li>
<li class="toctree-l3"><a class="reference internal" href="comments.html">3.9.4. 注释</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">3.9.5. Cocoa 和 Objective-C 特性</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#private">3.9.5.1. 成员变量应该是 <code class="docutils literal notranslate"><span class="pre">&#64;private</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#id1">3.9.5.2. 明确指定构造函数</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id2">3.9.5.3. 重载指定构造函数</a></li>
<li class="toctree-l4"><a class="reference internal" href="#nsobject">3.9.5.4. 重载 <code class="docutils literal notranslate"><span class="pre">NSObject</span></code> 的方法</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id3">3.9.5.5. 初始化</a></li>
<li class="toctree-l4"><a class="reference internal" href="#new">3.9.5.6. 避免 <code class="docutils literal notranslate"><span class="pre">+new</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#api">3.9.5.7. 保持公共 API 简单</a></li>
<li class="toctree-l4"><a class="reference internal" href="#import-and-include">3.9.5.8. <code class="docutils literal notranslate"><span class="pre">#import</span></code> and <code class="docutils literal notranslate"><span class="pre">#include</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#id5">3.9.5.9. 使用根框架</a></li>
<li class="toctree-l4"><a class="reference internal" href="#autorelease">3.9.5.10. 构建时即设定 <code class="docutils literal notranslate"><span class="pre">autorelease</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#autorelease-retain">3.9.5.11. <code class="docutils literal notranslate"><span class="pre">autorelease</span></code> 优先 <code class="docutils literal notranslate"><span class="pre">retain</span></code> 其次</a></li>
<li class="toctree-l4"><a class="reference internal" href="#init-dealloc">3.9.5.12. <code class="docutils literal notranslate"><span class="pre">init</span></code> 和 <code class="docutils literal notranslate"><span class="pre">dealloc</span></code> 内避免使用访问器</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id6">3.9.5.13. 按声明顺序销毁实例变量</a></li>
<li class="toctree-l4"><a class="reference internal" href="#setter-nsstrings">3.9.5.14. <code class="docutils literal notranslate"><span class="pre">setter</span></code> 应复制 NSStrings</a></li>
<li class="toctree-l4"><a class="reference internal" href="#avoid-throwing-exceptions">3.9.5.15. 避免抛异常</a></li>
<li class="toctree-l4"><a class="reference internal" href="#nil">3.9.5.16. nil 检查</a></li>
<li class="toctree-l4"><a class="reference internal" href="#bool">3.9.5.17. BOOL 若干陷阱</a></li>
<li class="toctree-l4"><a class="reference internal" href="#property">3.9.5.18. 属性（Property）</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id12">3.9.5.19. 没有实例变量的接口</a></li>
<li class="toctree-l4"><a class="reference internal" href="#synthesize">3.9.5.20. 自动 <code class="docutils literal notranslate"><span class="pre">synthesize</span></code> 实例变量</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="patterns.html">3.9.6. Cocoa 模式</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../google-java-styleguide/contents.html">3.10. Google: Java 风格指南</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../coding/index.html">4. 编程语言 语法</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../cheatsheet/index.html">5. Cheat Sheet</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../about.html">6. 关于</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="移动版导航菜单" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">AI 模型国内加速</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="页面导航">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../index.html"><span class="section-number">3. </span>编程语言 风格指南</a></li>
          <li class="breadcrumb-item"><a href="contents.html"><span class="section-number">3.9. </span>Google: Objective-C 风格指南</a></li>
      <li class="breadcrumb-item active"><span class="section-number">3.9.5. </span>Cocoa 和 Objective-C 特性</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../_sources/style-guides/google-objc-styleguide/features.rst.txt" rel="nofollow"> 查看页面源码</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="cocoa-objective-c">
<h1><span class="section-number">3.9.5. </span>Cocoa 和 Objective-C 特性<a class="headerlink" href="#cocoa-objective-c" title="Permalink to this heading"></a></h1>
<section id="private">
<h2><span class="section-number">3.9.5.1. </span>成员变量应该是 <code class="docutils literal notranslate"><span class="pre">&#64;private</span></code><a class="headerlink" href="#private" title="Permalink to this heading"></a></h2>
<div class="admonition tip">
<p class="admonition-title">小技巧</p>
<p>成员变量应该声明为 <code class="docutils literal notranslate"><span class="pre">&#64;private</span></code></p>
</div>
<div class="highlight-objc notranslate"><div class="highlight"><pre><span></span><span class="k">@interface</span> <span class="bp">MyClass</span> : <span class="bp">NSObject</span> <span class="p">{</span>
<span class="w"> </span><span class="k">@private</span>
<span class="w">  </span><span class="kt">id</span><span class="w"> </span><span class="n">myInstanceVariable_</span><span class="p">;</span>
<span class="p">}</span>
<span class="c1">// public accessors, setter takes ownership</span>
<span class="p">-</span> <span class="p">(</span><span class="kt">id</span><span class="p">)</span><span class="nf">myInstanceVariable</span><span class="p">;</span>
<span class="p">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">setMyInstanceVariable:</span><span class="p">(</span><span class="kt">id</span><span class="p">)</span><span class="nv">theVar</span><span class="p">;</span>
<span class="k">@end</span>
</pre></div>
</div>
</section>
<section id="id1">
<h2><span class="section-number">3.9.5.2. </span>明确指定构造函数<a class="headerlink" href="#id1" title="Permalink to this heading"></a></h2>
<div class="admonition tip">
<p class="admonition-title">小技巧</p>
<p>注释并且明确指定你的类的构造函数。</p>
</div>
<p>对于需要继承你的类的人来说，明确指定构造函数十分重要。这样他们就可以只重写一个构造函数（可能是几个）来保证他们的子类的构造函数会被调用。这也有助于将来别人调试你的类时，理解初始化代码的工作流程。</p>
</section>
<section id="id2">
<h2><span class="section-number">3.9.5.3. </span>重载指定构造函数<a class="headerlink" href="#id2" title="Permalink to this heading"></a></h2>
<div class="admonition tip">
<p class="admonition-title">小技巧</p>
<p>当你写子类的时候，如果需要 <code class="docutils literal notranslate"><span class="pre">init…</span></code> 方法，记得重载父类的指定构造函数。</p>
</div>
<p>如果你没有重载父类的指定构造函数，你的构造函数有时可能不会被调用，这会导致非常隐秘而且难以解决的 bug。</p>
</section>
<section id="nsobject">
<h2><span class="section-number">3.9.5.4. </span>重载 <code class="docutils literal notranslate"><span class="pre">NSObject</span></code> 的方法<a class="headerlink" href="#nsobject" title="Permalink to this heading"></a></h2>
<div class="admonition tip">
<p class="admonition-title">小技巧</p>
<p>如果重载了 <code class="docutils literal notranslate"><span class="pre">NSObject</span></code> 类的方法，强烈建议把它们放在 <code class="docutils literal notranslate"><span class="pre">&#64;implementation</span></code> 内的起始处，这也是常见的操作方法。</p>
</div>
<p>通常适用（但不局限）于 <code class="docutils literal notranslate"><span class="pre">init...</span></code>，<code class="docutils literal notranslate"><span class="pre">copyWithZone:</span></code>，以及 <code class="docutils literal notranslate"><span class="pre">dealloc</span></code> 方法。所有 <code class="docutils literal notranslate"><span class="pre">init...</span></code> 方法应该放在一起，<code class="docutils literal notranslate"><span class="pre">copyWithZone:</span></code> 紧随其后，最后才是 <code class="docutils literal notranslate"><span class="pre">dealloc</span></code> 方法。</p>
</section>
<section id="id3">
<h2><span class="section-number">3.9.5.5. </span>初始化<a class="headerlink" href="#id3" title="Permalink to this heading"></a></h2>
<div class="admonition tip">
<p class="admonition-title">小技巧</p>
<p>不要在 init 方法中，将成员变量初始化为 <code class="docutils literal notranslate"><span class="pre">0</span></code> 或者 <code class="docutils literal notranslate"><span class="pre">nil</span></code>；毫无必要。</p>
</div>
<p>刚分配的对象，默认值都是 0，除了 <code class="docutils literal notranslate"><span class="pre">isa</span></code> 指针（译者注：<code class="docutils literal notranslate"><span class="pre">NSObject</span></code> 的 <code class="docutils literal notranslate"><span class="pre">isa</span></code> 指针，用于标识对象的类型）。所以不要在初始化器里面写一堆将成员初始化为 <code class="docutils literal notranslate"><span class="pre">0</span></code> 或者 <code class="docutils literal notranslate"><span class="pre">nil</span></code> 的代码。</p>
</section>
<section id="new">
<h2><span class="section-number">3.9.5.6. </span>避免 <code class="docutils literal notranslate"><span class="pre">+new</span></code><a class="headerlink" href="#new" title="Permalink to this heading"></a></h2>
<div class="admonition tip">
<p class="admonition-title">小技巧</p>
<p>不要调用 <code class="docutils literal notranslate"><span class="pre">NSObject</span></code> 类方法 <code class="docutils literal notranslate"><span class="pre">new</span></code>，也不要在子类中重载它。使用 <code class="docutils literal notranslate"><span class="pre">alloc</span></code> 和 <code class="docutils literal notranslate"><span class="pre">init</span></code> 方法创建并初始化对象。</p>
</div>
<p>现代的 Objective-C 代码通过调用 <code class="docutils literal notranslate"><span class="pre">alloc</span></code> 和 <code class="docutils literal notranslate"><span class="pre">init</span></code> 方法来创建并 retain 一个对象。由于类方法 <code class="docutils literal notranslate"><span class="pre">new</span></code> 很少使用，这使得有关内存分配的代码审查更困难。</p>
</section>
<section id="api">
<h2><span class="section-number">3.9.5.7. </span>保持公共 API 简单<a class="headerlink" href="#api" title="Permalink to this heading"></a></h2>
<div class="admonition tip">
<p class="admonition-title">小技巧</p>
<p>保持类简单；避免 “厨房水槽（kitchen-sink）” 式的 API。如果一个函数压根没必要公开，就不要这么做。用私有类别保证公共头文件整洁。</p>
</div>
<p>与 C++ 不同，Objective-C 没有方法来区分公共的方法和私有的方法 – 所有的方法都是公共的（译者注：这取决于 Objective-C 运行时的方法调用的消息机制）。因此，除非客户端的代码期望使用某个方法，不要把这个方法放进公共 API 中。尽可能的避免了你你不希望被调用的方法却被调用到。这包括重载父类的方法。对于内部实现所需要的方法，在实现的文件中定义一个类别，而不是把它们放进公有的头文件中。</p>
<div class="highlight-objc notranslate"><div class="highlight"><pre><span></span><span class="c1">// GTMFoo.m</span>
<span class="cp">#import &quot;GTMFoo.h&quot;</span>

<span class="k">@interface</span> <span class="nc">GTMFoo</span> <span class="nl">(PrivateDelegateHandling)</span>
<span class="p">-</span> <span class="p">(</span><span class="bp">NSString</span><span class="w"> </span><span class="o">*</span><span class="p">)</span><span class="nf">doSomethingWithDelegate</span><span class="p">;</span><span class="w">  </span><span class="c1">// Declare private method</span>
<span class="k">@end</span>

<span class="k">@implementation</span> <span class="nc">GTMFoo</span><span class="nl">(PrivateDelegateHandling)</span>
<span class="p">...</span>
<span class="o">-</span><span class="w"> </span><span class="p">(</span><span class="bp">NSString</span><span class="w"> </span><span class="o">*</span><span class="p">)</span><span class="n">doSomethingWithDelegate</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="c1">// Implement this method</span>
<span class="p">}</span>
<span class="p">...</span>
<span class="k">@end</span>
</pre></div>
</div>
<p>Objective-C 2.0 以前，如果你在私有的 <code class="docutils literal notranslate"><span class="pre">&#64;interface</span></code> 中声明了某个方法，但在 <code class="docutils literal notranslate"><span class="pre">&#64;implementation</span></code> 中忘记定义这个方法，编译器不会抱怨（这是因为你没有在其它的类别中实现这个私有的方法）。解决文案是将方法放进指定类别的 <code class="docutils literal notranslate"><span class="pre">&#64;implemenation</span></code> 中。</p>
<p>如果你在使用 Objective-C 2.0，相反你应该使用 <a class="reference external" href="http://developer.apple.com/documentation/Cocoa/Conceptual/ObjectiveC/Articles/chapter_4_section_5.html">类扩展</a> 来声明你的私有类别，例如：</p>
<div class="highlight-objc notranslate"><div class="highlight"><pre><span></span><span class="k">@interface</span> <span class="nc">GMFoo</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="p">}</span>
</pre></div>
</div>
<p>这么做确保如果声明的方法没有在 <code class="docutils literal notranslate"><span class="pre">&#64;implementation</span></code> 中实现，会触发一个编译器告警。</p>
<p>再次说明，“私有的” 方法其实不是私有的。你有时可能不小心重载了父类的私有方法，因而制造出很难查找的 Bug。通常，私有的方法应该有一个相当特殊的名字以防止子类无意地重载它们。</p>
<p>Objective-C 的类别可以用来将一个大的 <code class="docutils literal notranslate"><span class="pre">&#64;implementation</span></code> 拆分成更容易理解的小块，同时，类别可以为最适合的类添加新的、特定应用程序的功能。例如，当添加一个 “middle truncation” 方法时，创建一个 <code class="docutils literal notranslate"><span class="pre">NSString</span></code> 的新类别并把方法放在里面，要比创建任意的一个新类把方法放进里面好得多。</p>
</section>
<section id="import-and-include">
<h2><span class="section-number">3.9.5.8. </span><code class="docutils literal notranslate"><span class="pre">#import</span></code> and <code class="docutils literal notranslate"><span class="pre">#include</span></code><a class="headerlink" href="#import-and-include" title="Permalink to this heading"></a></h2>
<div class="admonition tip">
<p class="admonition-title">小技巧</p>
<p><code class="docutils literal notranslate"><span class="pre">#import</span></code> Objective-C/Objective-C++ 头文件，<code class="docutils literal notranslate"><span class="pre">#include</span></code> C/C++ 头文件。</p>
</div>
<p>基于你所包括的头文件的编程语言，选择使用 <code class="docutils literal notranslate"><span class="pre">#import</span></code> 或是 <code class="docutils literal notranslate"><span class="pre">#include</span></code>：</p>
<ul class="simple">
<li><p>当包含一个使用 Objective-C、Objective-C++ 的头文件时，使用 <code class="docutils literal notranslate"><span class="pre">#import</span></code> 。</p></li>
<li><p>当包含一个使用标准 C、C++ 头文件时，使用 <code class="docutils literal notranslate"><span class="pre">#include</span></code>。头文件应该使用 <a class="reference external" href="http://google-styleguide.googlecode.com/svn/trunk/cppguide.xml?showone=The__define_Guard#The__define_Guard">#define 保护</a>。</p></li>
</ul>
<p>一些 Objective-C 的头文件缺少 <code class="docutils literal notranslate"><span class="pre">#define</span></code> 保护，需要使用 <code class="docutils literal notranslate"><span class="pre">#import</span></code> 的方式包含。由于 Objective-C 的头文件只会被 Objective-C 的源文件及头文件包含，广泛地使用 <code class="docutils literal notranslate"><span class="pre">#import</span></code> 是可以的。</p>
<p>文件中没有 Objective-C 代码的标准 C、C++ 头文件，很可能会被普通的 C、C++ 包含。由于标准 C、C++ 里面没有 <code class="docutils literal notranslate"><span class="pre">#import</span></code> 的用法，这些文件将被 <code class="docutils literal notranslate"><span class="pre">#include</span></code>。在 Objective-C 源文件中使用 <code class="docutils literal notranslate"><span class="pre">#include</span></code> 包含这些头文件，意味着这些头文件永远会在相同的语义下包含。</p>
<p>这条规则帮助跨平台的项目避免低级错误。某个 Mac 开发者写了一个新的 C 或 C++ 头文件，如果忘记使用 <code class="docutils literal notranslate"><span class="pre">#define</span></code> 保护，在 Mac 下使用 <code class="docutils literal notranslate"><span class="pre">#import</span></code> 这个头文件不回引起问题，但是在其它平台下使用 <code class="docutils literal notranslate"><span class="pre">#include</span></code> 将可能编译失败。在所有的平台上统一使用 <code class="docutils literal notranslate"><span class="pre">#include</span></code>，意味着构造更可能全都成功或者失败，防止这些文件只能在某些平台下能够工作。</p>
<div class="highlight-objc notranslate"><div class="highlight"><pre><span></span><span class="cp">#import &lt;Cocoa/Cocoa.h&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;CoreFoundation/CoreFoundation.h&gt;</span>
<span class="cp">#import &quot;GTMFoo.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;base/basictypes.h&quot;</span>
</pre></div>
</div>
</section>
<section id="id5">
<h2><span class="section-number">3.9.5.9. </span>使用根框架<a class="headerlink" href="#id5" title="Permalink to this heading"></a></h2>
<div class="admonition tip">
<p class="admonition-title">小技巧</p>
<p><code class="docutils literal notranslate"><span class="pre">#import</span></code> 根框架而不是单独的零散文件</p>
</div>
<p>当你试图从框架（如 Cocoa 或者 Foundation）中包含若干零散的系统头文件时，实际上包含顶层根框架的话，编译器要做的工作更少。根框架通常已经经过预编译，加载更快。另外记得使用 <code class="docutils literal notranslate"><span class="pre">#import</span></code> 而不是 <code class="docutils literal notranslate"><span class="pre">#include</span></code> 来包含 Objective-C 的框架。</p>
<div class="highlight-objc notranslate"><div class="highlight"><pre><span></span><span class="cp">#import &lt;Foundation/Foundation.h&gt;     </span><span class="c1">// good</span>

<span class="cp">#import &lt;Foundation/NSArray.h&gt;        </span><span class="c1">// avoid</span>
<span class="cp">#import &lt;Foundation/NSString.h&gt;</span>
<span class="p">...</span>
</pre></div>
</div>
</section>
<section id="autorelease">
<h2><span class="section-number">3.9.5.10. </span>构建时即设定 <code class="docutils literal notranslate"><span class="pre">autorelease</span></code><a class="headerlink" href="#autorelease" title="Permalink to this heading"></a></h2>
<div class="admonition tip">
<p class="admonition-title">小技巧</p>
<p>当创建临时对象时，在同一行使用 <code class="docutils literal notranslate"><span class="pre">autolease</span></code>，而不是在同一个方法的后面语句中使用一个单独的 <code class="docutils literal notranslate"><span class="pre">release</span></code>。</p>
</div>
<p>尽管运行效率会差一点，但避免了意外删除 <code class="docutils literal notranslate"><span class="pre">release</span></code> 或者插入 <code class="docutils literal notranslate"><span class="pre">return</span></code> 语句而导致内存泄露的可能。例如：</p>
<div class="highlight-objc notranslate"><div class="highlight"><pre><span></span><span class="c1">// AVOID (unless you have a compelling performance reason)</span>
<span class="n">MyController</span><span class="o">*</span><span class="w"> </span><span class="n">controller</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[[</span><span class="n">MyController</span><span class="w"> </span><span class="n">alloc</span><span class="p">]</span><span class="w"> </span><span class="n">init</span><span class="p">];</span>
<span class="c1">// ... code here that might return ...</span>
<span class="p">[</span><span class="n">controller</span><span class="w"> </span><span class="k">release</span><span class="p">];</span>

<span class="c1">// BETTER</span>
<span class="n">MyController</span><span class="o">*</span><span class="w"> </span><span class="n">controller</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[[[</span><span class="n">MyController</span><span class="w"> </span><span class="n">alloc</span><span class="p">]</span><span class="w"> </span><span class="n">init</span><span class="p">]</span><span class="w"> </span><span class="n">autorelease</span><span class="p">];</span>
</pre></div>
</div>
</section>
<section id="autorelease-retain">
<h2><span class="section-number">3.9.5.11. </span><code class="docutils literal notranslate"><span class="pre">autorelease</span></code> 优先 <code class="docutils literal notranslate"><span class="pre">retain</span></code> 其次<a class="headerlink" href="#autorelease-retain" title="Permalink to this heading"></a></h2>
<div class="admonition tip">
<p class="admonition-title">小技巧</p>
<p>给对象赋值时遵守 <code class="docutils literal notranslate"><span class="pre">autorelease``之后</span> <span class="pre">``retain</span></code> 的模式。</p>
</div>
<p>当给一个变量赋值新的对象时，必须先释放掉旧的对象以避免内存泄露。有很多 “正确的” 方法可以处理这种情况。我们则选择 “<code class="docutils literal notranslate"><span class="pre">autorelease</span></code> 之后 <code class="docutils literal notranslate"><span class="pre">retain</span></code>” 的方法，因为事实证明它不容易出错。注意大的循环会填满 <code class="docutils literal notranslate"><span class="pre">autorelease</span></code> 池，并且可能效率上会差一点，但权衡之下我们认为是可以接受的。</p>
<div class="highlight-objc notranslate"><div class="highlight"><pre><span></span><span class="p">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">setFoo:</span><span class="p">(</span><span class="n">GMFoo</span><span class="w"> </span><span class="o">*</span><span class="p">)</span><span class="nv">aFoo</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="p">[</span><span class="n">foo_</span><span class="w"> </span><span class="n">autorelease</span><span class="p">];</span><span class="w">  </span><span class="c1">// Won&#39;t dealloc if |foo_| == |aFoo|</span>
<span class="w">  </span><span class="n">foo_</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="n">aFoo</span><span class="w"> </span><span class="k">retain</span><span class="p">];</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
<section id="init-dealloc">
<h2><span class="section-number">3.9.5.12. </span><code class="docutils literal notranslate"><span class="pre">init</span></code> 和 <code class="docutils literal notranslate"><span class="pre">dealloc</span></code> 内避免使用访问器<a class="headerlink" href="#init-dealloc" title="Permalink to this heading"></a></h2>
<div class="admonition tip">
<p class="admonition-title">小技巧</p>
<p>在 <code class="docutils literal notranslate"><span class="pre">init</span></code> 和 <code class="docutils literal notranslate"><span class="pre">dealloc</span></code> 方法执行的过程中，子类可能会处在一个不一致的状态，所以这些方法中的代码应避免调用访问器。</p>
</div>
<p>子类尚未初始化，或在 <code class="docutils literal notranslate"><span class="pre">init</span></code> 和 <code class="docutils literal notranslate"><span class="pre">dealloc</span></code> 方法执行时已经被销毁，会使访问器方法很可能不可靠。实际上，应在这些方法中直接对 ivals 进行赋值或释放操作。</p>
<p>正确：</p>
<div class="highlight-objc notranslate"><div class="highlight"><pre><span></span><span class="p">-</span> <span class="p">(</span><span class="kt">id</span><span class="p">)</span><span class="nf">init</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nb">self</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="nb">super</span><span class="w"> </span><span class="n">init</span><span class="p">];</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nb">self</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">bar_</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[[</span><span class="bp">NSMutableString</span><span class="w"> </span><span class="n">alloc</span><span class="p">]</span><span class="w"> </span><span class="n">init</span><span class="p">];</span><span class="w">  </span><span class="c1">// good</span>
<span class="w">  </span><span class="p">}</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="nb">self</span><span class="p">;</span>
<span class="p">}</span>

<span class="p">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">dealloc</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="p">[</span><span class="n">bar_</span><span class="w"> </span><span class="k">release</span><span class="p">];</span><span class="w">                           </span><span class="c1">// good</span>
<span class="w">  </span><span class="p">[</span><span class="nb">super</span><span class="w"> </span><span class="n">dealloc</span><span class="p">];</span>
<span class="p">}</span>
</pre></div>
</div>
<p>错误：</p>
<div class="highlight-objc notranslate"><div class="highlight"><pre><span></span><span class="p">-</span> <span class="p">(</span><span class="kt">id</span><span class="p">)</span><span class="nf">init</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nb">self</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="nb">super</span><span class="w"> </span><span class="n">init</span><span class="p">];</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nb">self</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nb">self</span><span class="p">.</span><span class="n">bar</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="bp">NSMutableString</span><span class="w"> </span><span class="n">string</span><span class="p">];</span><span class="w">  </span><span class="c1">// avoid</span>
<span class="w">  </span><span class="p">}</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="nb">self</span><span class="p">;</span>
<span class="p">}</span>

<span class="p">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">dealloc</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nb">self</span><span class="p">.</span><span class="n">bar</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">nil</span><span class="p">;</span><span class="w">                         </span><span class="c1">// avoid</span>
<span class="w">  </span><span class="p">[</span><span class="nb">super</span><span class="w"> </span><span class="n">dealloc</span><span class="p">];</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
<section id="id6">
<h2><span class="section-number">3.9.5.13. </span>按声明顺序销毁实例变量<a class="headerlink" href="#id6" title="Permalink to this heading"></a></h2>
<div class="admonition tip">
<p class="admonition-title">小技巧</p>
<p><code class="docutils literal notranslate"><span class="pre">dealloc</span></code> 中实例变量被释放的顺序应该与它们在 <code class="docutils literal notranslate"><span class="pre">&#64;interface</span></code> 中声明的顺序一致，这有助于代码审查。</p>
</div>
<p>代码审查者在评审新的或者修改过的 <code class="docutils literal notranslate"><span class="pre">dealloc</span></code> 实现时，需要保证每个 <code class="docutils literal notranslate"><span class="pre">retained</span></code> 的实例变量都得到了释放。</p>
<p>为了简化 <code class="docutils literal notranslate"><span class="pre">dealloc</span></code> 的审查，<code class="docutils literal notranslate"><span class="pre">retained</span></code> 实例变量被释放的顺序应该与他们在 <code class="docutils literal notranslate"><span class="pre">&#64;interface</span></code> 中声明的顺序一致。如果 <code class="docutils literal notranslate"><span class="pre">dealloc</span></code> 调用了其它方法释放成员变量，添加注释解释这些方法释放了哪些实例变量。</p>
</section>
<section id="setter-nsstrings">
<h2><span class="section-number">3.9.5.14. </span><code class="docutils literal notranslate"><span class="pre">setter</span></code> 应复制 NSStrings<a class="headerlink" href="#setter-nsstrings" title="Permalink to this heading"></a></h2>
<div class="admonition tip">
<p class="admonition-title">小技巧</p>
<p>接受 <code class="docutils literal notranslate"><span class="pre">NSString</span></code> 作为参数的 <code class="docutils literal notranslate"><span class="pre">setter</span></code>，应该总是 <code class="docutils literal notranslate"><span class="pre">copy</span></code> 传入的字符串。</p>
</div>
<p>永远不要仅仅 <code class="docutils literal notranslate"><span class="pre">retain</span></code> 一个字符串。因为调用者很可能在你不知情的情况下修改了字符串。不要假定别人不会修改，你接受的对象是一个 <code class="docutils literal notranslate"><span class="pre">NSString</span></code> 对象而不是 <code class="docutils literal notranslate"><span class="pre">NSMutableString</span></code> 对象。</p>
<div class="highlight-objc notranslate"><div class="highlight"><pre><span></span><span class="p">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">setFoo:</span><span class="p">(</span><span class="bp">NSString</span><span class="w"> </span><span class="o">*</span><span class="p">)</span><span class="nv">aFoo</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="p">[</span><span class="n">foo_</span><span class="w"> </span><span class="n">autorelease</span><span class="p">];</span>
<span class="w">  </span><span class="n">foo_</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="n">aFoo</span><span class="w"> </span><span class="k">copy</span><span class="p">];</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
<section id="avoid-throwing-exceptions">
<span id="id7"></span><h2><span class="section-number">3.9.5.15. </span>避免抛异常<a class="headerlink" href="#avoid-throwing-exceptions" title="Permalink to this heading"></a></h2>
<div class="admonition tip">
<p class="admonition-title">小技巧</p>
<p>不要 <code class="docutils literal notranslate"><span class="pre">&#64;throw</span></code> Objective-C 异常，同时也要时刻准备捕获从第三方或 OS 代码中抛出的异常。</p>
</div>
<p>我们的确允许 <code class="docutils literal notranslate"><span class="pre">-fobjc-exceptions</span></code> 编译开关（主要因为我们要用到 <code class="docutils literal notranslate"><span class="pre">&#64;synchronized</span></code> ），但我们不使用 <code class="docutils literal notranslate"><span class="pre">&#64;throw</span></code>。为了合理使用第三方的代码，<code class="docutils literal notranslate"><span class="pre">&#64;try</span></code>、<code class="docutils literal notranslate"><span class="pre">&#64;catch</span></code> 和 <code class="docutils literal notranslate"><span class="pre">&#64;finally</span></code> 是允许的。如果你确实使用了异常，请明确注释你期望什么方法抛出异常。</p>
<p>不要使用 <code class="docutils literal notranslate"><span class="pre">NS_DURING</span></code>、<code class="docutils literal notranslate"><span class="pre">NS_HANDLER</span></code>、<code class="docutils literal notranslate"><span class="pre">NS_ENDHANDLER</span></code>、<code class="docutils literal notranslate"><span class="pre">NS_VALUERETURN</span></code> 和 <code class="docutils literal notranslate"><span class="pre">NS_VOIDRETURN</span></code> 宏，除非你写的代码需要在 Mac OS X 10.2 或之前的操作系统中运行。</p>
<p>注意：如果抛出 Objective-C 异常，Objective-C++ 代码中基于栈的对象不会被销毁。比如：</p>
<div class="highlight-objc notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="n">exceptiontest</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="n">public</span><span class="o">:</span>
<span class="w">  </span><span class="n">exceptiontest</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">NSLog</span><span class="p">(</span><span class="s">@&quot;Created&quot;</span><span class="p">);</span><span class="w"> </span><span class="p">}</span>
<span class="w">  </span><span class="o">~</span><span class="n">exceptiontest</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">NSLog</span><span class="p">(</span><span class="s">@&quot;Destroyed&quot;</span><span class="p">);</span><span class="w"> </span><span class="p">}</span>
<span class="p">};</span>

<span class="kt">void</span><span class="w"> </span><span class="nf">foo</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="n">exceptiontest</span><span class="w"> </span><span class="n">a</span><span class="p">;</span>
<span class="w">  </span><span class="bp">NSException</span><span class="w"> </span><span class="o">*</span><span class="n">exception</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="bp">NSException</span><span class="w"> </span><span class="n">exceptionWithName</span><span class="o">:</span><span class="s">@&quot;foo&quot;</span>
<span class="w">                                                   </span><span class="nl">reason</span><span class="p">:</span><span class="s">@&quot;bar&quot;</span>
<span class="w">                                                 </span><span class="nl">userInfo</span><span class="p">:</span><span class="nb">nil</span><span class="p">];</span>
<span class="w">  </span><span class="k">@throw</span><span class="w"> </span><span class="n">exception</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">argc</span><span class="p">,</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">argv</span><span class="p">[])</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="n">GMAutoreleasePool</span><span class="w"> </span><span class="n">pool</span><span class="p">;</span>
<span class="w">  </span><span class="k">@try</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">foo</span><span class="p">();</span>
<span class="w">  </span><span class="p">}</span>
<span class="w">  </span><span class="k">@catch</span><span class="p">(</span><span class="bp">NSException</span><span class="w"> </span><span class="o">*</span><span class="n">ex</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">NSLog</span><span class="p">(</span><span class="s">@&quot;exception raised&quot;</span><span class="p">);</span>
<span class="w">  </span><span class="p">}</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>会输出：</p>
<p>注意：这里析构函数从未被调用。这主要会影响基于栈的 <code class="docutils literal notranslate"><span class="pre">smartptr</span></code>，比如 <code class="docutils literal notranslate"><span class="pre">shared_ptr</span></code>、<code class="docutils literal notranslate"><span class="pre">linked_ptr</span></code>，以及所有你可能用到的 STL 对象。因此我们不得不痛苦的说，如果必须在 Objective-C++ 中使用异常，就只用 C++ 的异常机制。永远不应该重新抛出 Objective-C 异常，也不应该在 <code class="docutils literal notranslate"><span class="pre">&#64;try</span></code>、<code class="docutils literal notranslate"><span class="pre">&#64;catch</span></code> 或 <code class="docutils literal notranslate"><span class="pre">&#64;finally</span></code> 语句块中使用基于栈的 C++ 对象。</p>
</section>
<section id="nil">
<h2><span class="section-number">3.9.5.16. </span>nil 检查<a class="headerlink" href="#nil" title="Permalink to this heading"></a></h2>
<div class="admonition tip">
<p class="admonition-title">小技巧</p>
<p><code class="docutils literal notranslate"><span class="pre">nil</span></code> 检查只用在逻辑流程中。</p>
</div>
<p>使用 <code class="docutils literal notranslate"><span class="pre">nil</span></code> 的检查来检查应用程序的逻辑流程，而不是避免崩溃。Objective-C 运行时会处理向 <code class="docutils literal notranslate"><span class="pre">nil</span></code> 对象发送消息的情况。如果方法没有返回值，就没关系。如果有返回值，可能由于运行时架构、返回值类型以及 OS X 版本的不同而不同，参见 <a class="reference external" href="http://developer.apple.com/documentation/Cocoa/Conceptual/ObjectiveC/Articles/chapter_2_section_3.html">Apple’s documentation</a> 。</p>
<p>注意，这和 C/C++ 中检查指针是否为 ‵‵NULL`` 很不一样，C/C++ 运行时不做任何检查，从而导致应用程序崩溃。因此你仍然需要保证你不会对一个 C/C++ 的空指针解引用。</p>
</section>
<section id="bool">
<h2><span class="section-number">3.9.5.17. </span>BOOL 若干陷阱<a class="headerlink" href="#bool" title="Permalink to this heading"></a></h2>
<div class="admonition tip">
<p class="admonition-title">小技巧</p>
<p>将普通整形转换成 <code class="docutils literal notranslate"><span class="pre">BOOL</span></code> 时要小心。不要直接将 <code class="docutils literal notranslate"><span class="pre">BOOL</span></code> 值与 <code class="docutils literal notranslate"><span class="pre">YES</span></code> 进行比较。</p>
</div>
<p>Objective-C 中把 <code class="docutils literal notranslate"><span class="pre">BOOL</span></code> 定义成无符号字符型，这意味着 <code class="docutils literal notranslate"><span class="pre">BOOL</span></code> 类型的值远不止 <code class="docutils literal notranslate"><span class="pre">YES``(1)或</span> <span class="pre">``NO``(0)。不要直接把整形转换成</span> <span class="pre">``BOOL</span></code>。常见的错误包括将数组的大小、指针值及位运算的结果直接转换成 <code class="docutils literal notranslate"><span class="pre">BOOL</span></code> ，取决于整型结果的最后一个字节，很可能会产生一个 <code class="docutils literal notranslate"><span class="pre">NO</span></code> 值。当转换整形至 <code class="docutils literal notranslate"><span class="pre">BOOL</span></code> 时，使用三目操作符来返回 <code class="docutils literal notranslate"><span class="pre">YES</span></code> 或者 <code class="docutils literal notranslate"><span class="pre">NO</span></code>。（译者注：读者可以试一下任意的 256 的整数的转换结果，如 256、512 …）</p>
<p>你可以安全在 <code class="docutils literal notranslate"><span class="pre">BOOL</span></code>、<code class="docutils literal notranslate"><span class="pre">_Bool</span></code> 以及 <code class="docutils literal notranslate"><span class="pre">bool</span></code> 之间转换（参见 C++ Std 4.7.4, 4.12 以及 C99 Std 6.3.1.2）。你不能安全在 <code class="docutils literal notranslate"><span class="pre">BOOL</span></code> 以及 <code class="docutils literal notranslate"><span class="pre">Boolean</span></code> 之间转换，因此请把 <code class="docutils literal notranslate"><span class="pre">Boolean</span></code> 当作一个普通整形，就像之前讨论的那样。但 Objective-C 的方法标识符中，只使用 <code class="docutils literal notranslate"><span class="pre">BOOL</span></code>。</p>
<p>对 <code class="docutils literal notranslate"><span class="pre">BOOL</span></code> 使用逻辑运算符（<code class="docutils literal notranslate"><span class="pre">&amp;&amp;</span></code>，<code class="docutils literal notranslate"><span class="pre">||</span></code> 和 <code class="docutils literal notranslate"><span class="pre">!</span></code>）是合法的，返回值也可以安全地转换成 <code class="docutils literal notranslate"><span class="pre">BOOL</span></code>，不需要使用三目操作符。</p>
<p>错误的用法：</p>
<div class="highlight-objc notranslate"><div class="highlight"><pre><span></span><span class="p">-</span> <span class="p">(</span><span class="kt">BOOL</span><span class="p">)</span><span class="nf">isBold</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">[</span><span class="nb">self</span><span class="w"> </span><span class="n">fontTraits</span><span class="p">]</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">NSFontBoldTrait</span><span class="p">;</span>
<span class="p">}</span>
<span class="p">-</span> <span class="p">(</span><span class="kt">BOOL</span><span class="p">)</span><span class="nf">isValid</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">[</span><span class="nb">self</span><span class="w"> </span><span class="n">stringValue</span><span class="p">];</span>
<span class="p">}</span>
</pre></div>
</div>
<p>正确的用法：</p>
<div class="highlight-objc notranslate"><div class="highlight"><pre><span></span><span class="p">-</span> <span class="p">(</span><span class="kt">BOOL</span><span class="p">)</span><span class="nf">isBold</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">([</span><span class="nb">self</span><span class="w"> </span><span class="n">fontTraits</span><span class="p">]</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">NSFontBoldTrait</span><span class="p">)</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="nb">YES</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="nb">NO</span><span class="p">;</span>
<span class="p">}</span>
<span class="p">-</span> <span class="p">(</span><span class="kt">BOOL</span><span class="p">)</span><span class="nf">isValid</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">[</span><span class="nb">self</span><span class="w"> </span><span class="n">stringValue</span><span class="p">]</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="nb">nil</span><span class="p">;</span>
<span class="p">}</span>
<span class="p">-</span> <span class="p">(</span><span class="kt">BOOL</span><span class="p">)</span><span class="nf">isEnabled</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">[</span><span class="nb">self</span><span class="w"> </span><span class="n">isValid</span><span class="p">]</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="p">[</span><span class="nb">self</span><span class="w"> </span><span class="n">isBold</span><span class="p">];</span>
<span class="p">}</span>
</pre></div>
</div>
<p>同样，不要直接比较 <code class="docutils literal notranslate"><span class="pre">YES/NO</span></code> 和 <code class="docutils literal notranslate"><span class="pre">BOOL</span></code> 变量。不仅仅因为影响可读性，更重要的是结果可能与你想的不同。</p>
<p>错误的用法：</p>
<div class="highlight-objc notranslate"><div class="highlight"><pre><span></span><span class="kt">BOOL</span><span class="w"> </span><span class="n">great</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="n">foo</span><span class="w"> </span><span class="n">isGreat</span><span class="p">];</span>
<span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">great</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nb">YES</span><span class="p">)</span>
<span class="w">  </span><span class="c1">// ...be great!</span>
</pre></div>
</div>
<p>正确的用法：</p>
<div class="highlight-objc notranslate"><div class="highlight"><pre><span></span><span class="kt">BOOL</span><span class="w"> </span><span class="n">great</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="n">foo</span><span class="w"> </span><span class="n">isGreat</span><span class="p">];</span>
<span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">great</span><span class="p">)</span>
<span class="w">  </span><span class="c1">// ...be great!</span>
</pre></div>
</div>
</section>
<section id="property">
<h2><span class="section-number">3.9.5.18. </span>属性（Property）<a class="headerlink" href="#property" title="Permalink to this heading"></a></h2>
<div class="admonition tip">
<p class="admonition-title">小技巧</p>
<p>属性（Property）通常允许使用，但需要清楚的了解：属性（Property）是 Objective-C 2.0 的特性，会限制你的代码只能跑在 iPhone 和 Mac OS X 10.5 (Leopard) 及更高版本上。点引用只允许访问声明过的 <code class="docutils literal notranslate"><span class="pre">&#64;property</span></code>。</p>
</div>
<section id="id8">
<h3><span class="section-number">3.9.5.18.1. </span>命名<a class="headerlink" href="#id8" title="Permalink to this heading"></a></h3>
<p>属性所关联的实例变量的命名必须遵守以下划线作为后缀的规则。属性的名字应该与成员变量去掉下划线后缀的名字一模一样。</p>
<p>使用 <code class="docutils literal notranslate"><span class="pre">&#64;synthesize</span></code> 指示符来正确地重命名属性。</p>
<div class="highlight-objc notranslate"><div class="highlight"><pre><span></span><span class="k">@interface</span> <span class="bp">MyClass</span> : <span class="bp">NSObject</span> <span class="p">{</span>
<span class="w"> </span><span class="k">@private</span>
<span class="w">  </span><span class="bp">NSString</span><span class="w"> </span><span class="o">*</span><span class="n">name_</span><span class="p">;</span>
<span class="p">}</span>
<span class="k">@property</span><span class="p">(</span><span class="k">copy</span><span class="p">,</span><span class="w"> </span><span class="k">nonatomic</span><span class="p">)</span><span class="w"> </span><span class="bp">NSString</span><span class="w"> </span><span class="o">*</span><span class="n">name</span><span class="p">;</span>
<span class="k">@end</span>

<span class="k">@implementation</span> <span class="bp">MyClass</span>
<span class="k">@synthesize</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">name_</span><span class="p">;</span>
<span class="k">@end</span>
</pre></div>
</div>
</section>
<section id="id9">
<h3><span class="section-number">3.9.5.18.2. </span>位置<a class="headerlink" href="#id9" title="Permalink to this heading"></a></h3>
<p>属性的声明必须紧靠着类接口中的实例变量语句块。属性的定义必须在 <code class="docutils literal notranslate"><span class="pre">&#64;implementation</span></code> 的类定义的最上方。他们的缩进与包含他们的 <code class="docutils literal notranslate"><span class="pre">&#64;interface</span></code> 以及 <code class="docutils literal notranslate"><span class="pre">&#64;implementation</span></code> 语句一样。</p>
<div class="highlight-objc notranslate"><div class="highlight"><pre><span></span><span class="k">@interface</span> <span class="bp">MyClass</span> : <span class="bp">NSObject</span> <span class="p">{</span>
<span class="w"> </span><span class="k">@private</span>
<span class="w">  </span><span class="bp">NSString</span><span class="w"> </span><span class="o">*</span><span class="n">name_</span><span class="p">;</span>
<span class="p">}</span>
<span class="k">@property</span><span class="p">(</span><span class="k">copy</span><span class="p">,</span><span class="w"> </span><span class="k">nonatomic</span><span class="p">)</span><span class="w"> </span><span class="bp">NSString</span><span class="w"> </span><span class="o">*</span><span class="n">name</span><span class="p">;</span>
<span class="k">@end</span>

<span class="k">@implementation</span> <span class="bp">MyClass</span>
<span class="k">@synthesize</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">name_</span><span class="p">;</span>
<span class="p">-</span> <span class="p">(</span><span class="kt">id</span><span class="p">)</span><span class="nf">init</span><span class="w"> </span><span class="p">{</span>
<span class="p">...</span>
<span class="p">}</span>
<span class="k">@end</span>
</pre></div>
</div>
</section>
<section id="copy-attribute">
<h3><span class="section-number">3.9.5.18.3. </span>字符串应使用 <code class="docutils literal notranslate"><span class="pre">copy</span></code> 属性（Attribute）<a class="headerlink" href="#copy-attribute" title="Permalink to this heading"></a></h3>
<p>应总是用 <code class="docutils literal notranslate"><span class="pre">copy</span></code> 属性（attribute）声明 <code class="docutils literal notranslate"><span class="pre">NSString</span></code> 属性（property）。</p>
<p>从逻辑上，确保遵守 <code class="docutils literal notranslate"><span class="pre">NSString</span></code> 的 <code class="docutils literal notranslate"><span class="pre">setter</span></code> 必须使用 <code class="docutils literal notranslate"><span class="pre">copy</span></code> 而不是 <code class="docutils literal notranslate"><span class="pre">retain</span></code> 的原则。</p>
</section>
<section id="id10">
<h3><span class="section-number">3.9.5.18.4. </span>原子性<a class="headerlink" href="#id10" title="Permalink to this heading"></a></h3>
<p>一定要注意属性（property）的开销。缺省情况下，所有 <code class="docutils literal notranslate"><span class="pre">synthesize</span></code> 的 <code class="docutils literal notranslate"><span class="pre">setter</span></code> 和 <code class="docutils literal notranslate"><span class="pre">getter</span></code> 都是原子的。这会给每个 <code class="docutils literal notranslate"><span class="pre">get</span></code> 或者 <code class="docutils literal notranslate"><span class="pre">set</span></code> 带来一定的同步开销。将属性（property）声明为 <code class="docutils literal notranslate"><span class="pre">nonatomic</span></code>，除非你需要原子性。</p>
</section>
<section id="id11">
<h3><span class="section-number">3.9.5.18.5. </span>点引用<a class="headerlink" href="#id11" title="Permalink to this heading"></a></h3>
<p>点引用是地道的 Objective-C 2.0 风格。它被使用于简单的属性 <code class="docutils literal notranslate"><span class="pre">set</span></code>、<code class="docutils literal notranslate"><span class="pre">get</span></code> 操作，但不应该用它来调用对象的其它操作。</p>
<p>正确的做法：</p>
<div class="highlight-objc notranslate"><div class="highlight"><pre><span></span><span class="bp">NSString</span><span class="w"> </span><span class="o">*</span><span class="n">oldName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">myObject</span><span class="p">.</span><span class="n">name</span><span class="p">;</span>
<span class="n">myObject</span><span class="p">.</span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">@&quot;Alice&quot;</span><span class="p">;</span>
</pre></div>
</div>
<p>错误的做法：</p>
<div class="highlight-objc notranslate"><div class="highlight"><pre><span></span><span class="bp">NSArray</span><span class="w"> </span><span class="o">*</span><span class="n">array</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[[</span><span class="bp">NSArray</span><span class="w"> </span><span class="n">arrayWithObject</span><span class="o">:</span><span class="s">@&quot;hello&quot;</span><span class="p">]</span><span class="w"> </span><span class="k">retain</span><span class="p">];</span>

<span class="n">NSUInteger</span><span class="w"> </span><span class="n">numberOfItems</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">array</span><span class="p">.</span><span class="n">count</span><span class="p">;</span><span class="w">  </span><span class="c1">// not a property</span>
<span class="n">array</span><span class="p">.</span><span class="k">release</span><span class="p">;</span><span class="w">                           </span><span class="c1">// not a property</span>
</pre></div>
</div>
</section>
</section>
<section id="id12">
<h2><span class="section-number">3.9.5.19. </span>没有实例变量的接口<a class="headerlink" href="#id12" title="Permalink to this heading"></a></h2>
<div class="admonition tip">
<p class="admonition-title">小技巧</p>
<p>没有声明任何实例变量的接口，应省略空花括号。</p>
</div>
<p>正确的做法：</p>
<blockquote>
<div><p>&#64;interface MyClass : NSObject
// Does a lot of stuff
- (void)fooBarBam;
&#64;end</p>
</div></blockquote>
<p>错误的做法：</p>
<blockquote>
<div><p>&#64;interface MyClass : NSObject {
}
// Does a lot of stuff
- (void)fooBarBam;
&#64;end</p>
</div></blockquote>
</section>
<section id="synthesize">
<h2><span class="section-number">3.9.5.20. </span>自动 <code class="docutils literal notranslate"><span class="pre">synthesize</span></code> 实例变量<a class="headerlink" href="#synthesize" title="Permalink to this heading"></a></h2>
<div class="admonition tip">
<p class="admonition-title">小技巧</p>
<p>只运行在 iOS 下的代码，优先考虑使用自动 <code class="docutils literal notranslate"><span class="pre">synthesize</span></code> 实例变量。</p>
</div>
<p><code class="docutils literal notranslate"><span class="pre">synthesize</span></code> 实例变量时，使用 <code class="docutils literal notranslate"><span class="pre">&#64;synthesize</span> <span class="pre">var</span> <span class="pre">=</span> <span class="pre">var_;</span></code> 防止原本想调用 <code class="docutils literal notranslate"><span class="pre">self.var</span> <span class="pre">=</span> <span class="pre">blah;</span></code> 却不慎写成了 <code class="docutils literal notranslate"><span class="pre">var</span> <span class="pre">=</span> <span class="pre">blah;</span></code>。</p>
<p>不要synthesize CFType的属性 CFType应该永远使用&#64;dynamic实现指示符。 尽管CFType不能使用retain属性特性，开发者必须自己处理retain和release。很少有情况你需要仅仅对它进行赋值，因此最好显示地实现getter和setter，并作出注释说明。 列出所有的实现指示符 尽管&#64;dynamic是默认的，显示列出它以及其它的实现指示符会提高可读性，代码阅读者可以一眼就知道类的每个属性是如何实现的。</p>
<div class="highlight-objc notranslate"><div class="highlight"><pre><span></span><span class="c1">// Header file</span>
<span class="k">@interface</span> <span class="nc">Foo</span> : <span class="bp">NSObject</span>
<span class="c1">// A guy walks into a bar.</span>
<span class="k">@property</span><span class="p">(</span><span class="k">nonatomic</span><span class="p">,</span><span class="w"> </span><span class="k">copy</span><span class="p">)</span><span class="w"> </span><span class="bp">NSString</span><span class="w"> </span><span class="o">*</span><span class="n">bar</span><span class="p">;</span>
<span class="k">@end</span>

<span class="c1">// Implementation file</span>
<span class="k">@interface</span> <span class="nc">Foo</span><span class="w"> </span><span class="p">()</span>
<span class="k">@property</span><span class="p">(</span><span class="k">nonatomic</span><span class="p">,</span><span class="w"> </span><span class="k">retain</span><span class="p">)</span><span class="w"> </span><span class="bp">NSArray</span><span class="w"> </span><span class="o">*</span><span class="n">baz</span><span class="p">;</span>
<span class="k">@end</span>

<span class="k">@implementation</span> <span class="nc">Foo</span>
<span class="k">@synthesize</span><span class="w"> </span><span class="n">bar</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">bar_</span><span class="p">;</span>
<span class="k">@synthesize</span><span class="w"> </span><span class="n">baz</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">baz_</span><span class="p">;</span>
<span class="k">@end</span>
</pre></div>
</div>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="页脚">
        <a href="comments.html" class="btn btn-neutral float-left" title="3.9.4. 注释" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> 上一页</a>
        <a href="patterns.html" class="btn btn-neutral float-right" title="3.9.6. Cocoa 模式" accesskey="n" rel="next">下一页 <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; 版权所有 2024.</p>
  </div>

  利用 <a href="https://www.sphinx-doc.org/">Sphinx</a> 构建，使用的 
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">主题</a>
    由 <a href="https://readthedocs.org">Read the Docs</a> 开发.
  
<div class="view_counter">
      <img class="img_view_counter" src="https://s01.flagcounter.com/count2/m02K/bg_FFFFFF/txt_F77B1B/border_CCCCCC/columns_3/maxflags_6/viewers_3/labels_1/pageviews_0/flags_0/percent_0/" alt="View Counter" border="0" />
</div>


</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>
<div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="版本">
    <span class="rst-current-version" data-toggle="rst-current-version">
        <span class="fa fa-book"> Read the Docs</span>
        v: latest
        <span class="fa fa-caret-down"></span>
    </span>
    <div class="rst-other-versions">
        <dl>
            <dt>版本</dt>
            <dd><a href="#">latest</a></dd>
        </dl>
    </div>
</div>

</body>
</html>