<!DOCTYPE html>
<html class="writer-html5" lang="zh-CN">
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>3.2.56. Test Tables &mdash; AI 模型国内加速  文档</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/theme.css" />
      <link rel="stylesheet" type="text/css" href="../../_static/style.css" />

  
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/translations.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="author" title="关于这些文档" href="../../about.html" />
    <link rel="index" title="索引" href="../../genindex.html" />
    <link rel="search" title="搜索" href="../../search.html" />
    <link rel="next" title="3.2.57. Use &#34;time&#34; to handle time" href="time.html" />
    <link rel="prev" title="3.2.55. Use var for Zero Value Structs" href="struct-zero.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            AI 模型国内加速
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="搜索文档" aria-label="搜索文档" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="导航菜单">
              <p class="caption" role="heading"><span class="caption-text">目录:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../best-practice/index.html">1. 【AI网盘】人工智能资源汇总</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../stable-diffusion/index.html">2. Stable Diffusion</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">3. 编程语言 规范</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../uber_go_cn/index.html">3.1. Uber Go语言规范 中文</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html">3.2. Uber: Go语言规范</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="SUMMARY.html">3.2.1. Uber Go Style Guide</a></li>
<li class="toctree-l3"><a class="reference internal" href="atomic.html">3.2.2. Use go.uber.org/atomic</a></li>
<li class="toctree-l3"><a class="reference internal" href="builtin-name.html">3.2.3. Avoid Using Built-In Names</a></li>
<li class="toctree-l3"><a class="reference internal" href="channel-size.html">3.2.4. Channel Size is One or None</a></li>
<li class="toctree-l3"><a class="reference internal" href="consistency.html">3.2.5. Be Consistent</a></li>
<li class="toctree-l3"><a class="reference internal" href="container-capacity.html">3.2.6. Prefer Specifying Container Capacity</a></li>
<li class="toctree-l3"><a class="reference internal" href="container-copy.html">3.2.7. Copy Slices and Maps at Boundaries</a></li>
<li class="toctree-l3"><a class="reference internal" href="decl-group.html">3.2.8. Group Similar Declarations</a></li>
<li class="toctree-l3"><a class="reference internal" href="defer-clean.html">3.2.9. Defer to Clean Up</a></li>
<li class="toctree-l3"><a class="reference internal" href="else-unnecessary.html">3.2.10. Unnecessary Else</a></li>
<li class="toctree-l3"><a class="reference internal" href="embed-public.html">3.2.11. Avoid Embedding Types in Public Structs</a></li>
<li class="toctree-l3"><a class="reference internal" href="enum-start.html">3.2.12. Start Enums at One</a></li>
<li class="toctree-l3"><a class="reference internal" href="error-name.html">3.2.13. Error Naming</a></li>
<li class="toctree-l3"><a class="reference internal" href="error-once.html">3.2.14. Handle Errors Once</a></li>
<li class="toctree-l3"><a class="reference internal" href="error-type.html">3.2.15. Error Types</a></li>
<li class="toctree-l3"><a class="reference internal" href="error-wrap.html">3.2.16. Error Wrapping</a></li>
<li class="toctree-l3"><a class="reference internal" href="exit-main.html">3.2.17. Exit in Main</a></li>
<li class="toctree-l3"><a class="reference internal" href="exit-once.html">3.2.18. Exit Once</a></li>
<li class="toctree-l3"><a class="reference internal" href="function-name.html">3.2.19. Function Names</a></li>
<li class="toctree-l3"><a class="reference internal" href="function-order.html">3.2.20. Function Grouping and Ordering</a></li>
<li class="toctree-l3"><a class="reference internal" href="functional-option.html">3.2.21. Functional Options</a></li>
<li class="toctree-l3"><a class="reference internal" href="global-decl.html">3.2.22. Top-level Variable Declarations</a></li>
<li class="toctree-l3"><a class="reference internal" href="global-mut.html">3.2.23. Avoid Mutable Globals</a></li>
<li class="toctree-l3"><a class="reference internal" href="global-name.html">3.2.24. Prefix Unexported Globals with _</a></li>
<li class="toctree-l3"><a class="reference internal" href="goroutine-exit.html">3.2.25. Wait for goroutines to exit</a></li>
<li class="toctree-l3"><a class="reference internal" href="goroutine-forget.html">3.2.26. Don’t fire-and-forget goroutines</a></li>
<li class="toctree-l3"><a class="reference internal" href="goroutine-init.html">3.2.27. No goroutines in <code class="docutils literal notranslate"><span class="pre">init()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="import-alias.html">3.2.28. Import Aliasing</a></li>
<li class="toctree-l3"><a class="reference internal" href="import-group.html">3.2.29. Import Group Ordering</a></li>
<li class="toctree-l3"><a class="reference internal" href="init.html">3.2.30. Avoid <code class="docutils literal notranslate"><span class="pre">init()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="interface-compliance.html">3.2.31. Verify Interface Compliance</a></li>
<li class="toctree-l3"><a class="reference internal" href="interface-pointer.html">3.2.32. Pointers to Interfaces</a></li>
<li class="toctree-l3"><a class="reference internal" href="interface-receiver.html">3.2.33. Receivers and Interfaces</a></li>
<li class="toctree-l3"><a class="reference internal" href="intro.html">3.2.34. Introduction</a></li>
<li class="toctree-l3"><a class="reference internal" href="line-length.html">3.2.35. Avoid overly long lines</a></li>
<li class="toctree-l3"><a class="reference internal" href="lint.html">3.2.36. Linting</a></li>
<li class="toctree-l3"><a class="reference internal" href="map-init.html">3.2.37. Initializing Maps</a></li>
<li class="toctree-l3"><a class="reference internal" href="mutex-zero-value.html">3.2.38. Zero-value Mutexes are Valid</a></li>
<li class="toctree-l3"><a class="reference internal" href="nest-less.html">3.2.39. Reduce Nesting</a></li>
<li class="toctree-l3"><a class="reference internal" href="package-name.html">3.2.40. Package Names</a></li>
<li class="toctree-l3"><a class="reference internal" href="panic.html">3.2.41. Don’t Panic</a></li>
<li class="toctree-l3"><a class="reference internal" href="param-naked.html">3.2.42. Avoid Naked Parameters</a></li>
<li class="toctree-l3"><a class="reference internal" href="performance.html">3.2.43. Performance</a></li>
<li class="toctree-l3"><a class="reference internal" href="printf-const.html">3.2.44. Format Strings outside Printf</a></li>
<li class="toctree-l3"><a class="reference internal" href="printf-name.html">3.2.45. Naming Printf-style Functions</a></li>
<li class="toctree-l3"><a class="reference internal" href="slice-nil.html">3.2.46. nil is a valid slice</a></li>
<li class="toctree-l3"><a class="reference internal" href="strconv.html">3.2.47. Prefer strconv over fmt</a></li>
<li class="toctree-l3"><a class="reference internal" href="string-byte-slice.html">3.2.48. Avoid repeated string-to-byte conversions</a></li>
<li class="toctree-l3"><a class="reference internal" href="string-escape.html">3.2.49. Use Raw String Literals to Avoid Escaping</a></li>
<li class="toctree-l3"><a class="reference internal" href="struct-embed.html">3.2.50. Embedding in Structs</a></li>
<li class="toctree-l3"><a class="reference internal" href="struct-field-key.html">3.2.51. Use Field Names to Initialize Structs</a></li>
<li class="toctree-l3"><a class="reference internal" href="struct-field-zero.html">3.2.52. Omit Zero Value Fields in Structs</a></li>
<li class="toctree-l3"><a class="reference internal" href="struct-pointer.html">3.2.53. Initializing Struct References</a></li>
<li class="toctree-l3"><a class="reference internal" href="struct-tag.html">3.2.54. Use field tags in marshaled structs</a></li>
<li class="toctree-l3"><a class="reference internal" href="struct-zero.html">3.2.55. Use <code class="docutils literal notranslate"><span class="pre">var</span></code> for Zero Value Structs</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">3.2.56. Test Tables</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#avoid-unnecessary-complexity-in-table-tests">3.2.56.1. Avoid Unnecessary Complexity in Table Tests</a></li>
<li class="toctree-l4"><a class="reference internal" href="#parallel-tests">3.2.56.2. Parallel Tests</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="time.html">3.2.57. Use <code class="docutils literal notranslate"><span class="pre">&quot;time&quot;</span></code> to handle time</a></li>
<li class="toctree-l3"><a class="reference internal" href="type-assert.html">3.2.58. Handle Type Assertion Failures</a></li>
<li class="toctree-l3"><a class="reference internal" href="var-decl.html">3.2.59. Local Variable Declarations</a></li>
<li class="toctree-l3"><a class="reference internal" href="var-scope.html">3.2.60. Reduce Scope of Variables</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../google-cpp-styleguide/contents.html">3.3. C++ 风格指南 - 内容目录</a></li>
<li class="toctree-l2"><a class="reference internal" href="../google-objc-styleguide/contents.html">3.4. Objective-C 风格指南 - 内容目录</a></li>
<li class="toctree-l2"><a class="reference internal" href="../google-python-styleguide/contents.html">3.5. Python 风格指南 - 内容目录</a></li>
<li class="toctree-l2"><a class="reference internal" href="../google-shell-styleguide/contents.html">3.6. Shell 风格指南 - 内容目录</a></li>
<li class="toctree-l2"><a class="reference internal" href="../google-javascript-styleguide/contents.html">3.7. Javascript 风格指南 - 内容目录</a></li>
<li class="toctree-l2"><a class="reference internal" href="../google-typescript-styleguide/contents.html">3.8. TypeScript 风格指南</a></li>
<li class="toctree-l2"><a class="reference internal" href="../google-html-css-styleguide/contents.html">3.9. HTML/CSS 风格指南 - 内容目录</a></li>
<li class="toctree-l2"><a class="reference internal" href="../google-java-styleguide/contents.html">3.10. Java 风格指南 - 内容目录</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../coding/index.html">4. 编程语言 语法</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../cheatsheet/index.html">5. Cheat Sheet</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../about.html">6. 关于</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="移动版导航菜单" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">AI 模型国内加速</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="页面导航">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../index.html"><span class="section-number">3. </span>编程语言 规范</a></li>
          <li class="breadcrumb-item"><a href="index.html"><span class="section-number">3.2. </span>Uber: Go语言规范</a></li>
      <li class="breadcrumb-item active"><span class="section-number">3.2.56. </span>Test Tables</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../_sources/style-guides/uber_go/test-table.md.txt" rel="nofollow"> 查看页面源码</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="test-tables">
<h1><span class="section-number">3.2.56. </span>Test Tables<a class="headerlink" href="#test-tables" title="Permalink to this heading"></a></h1>
<p>Table-driven tests with <a class="reference external" href="https://go.dev/blog/subtests">subtests</a> can be a helpful pattern for writing tests
to avoid duplicating code when the core test logic is repetitive.</p>
<p>If a system under test needs to be tested against <em>multiple conditions</em> where
certain parts of the the inputs and outputs change, a table-driven test should
be used to reduce redundancy and improve readability.</p>
<table>
<thead><tr><th>Bad</th><th>Good</th></tr></thead>
<tbody>
<tr><td><div class="highlight-go notranslate"><div class="highlight"><pre><span></span><span class="c1">// func TestSplitHostPort(t *testing.T)</span>

<span class="nx">host</span><span class="p">,</span><span class="w"> </span><span class="nx">port</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">net</span><span class="p">.</span><span class="nx">SplitHostPort</span><span class="p">(</span><span class="s">&quot;192.0.2.0:8000&quot;</span><span class="p">)</span>
<span class="nx">require</span><span class="p">.</span><span class="nx">NoError</span><span class="p">(</span><span class="nx">t</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
<span class="nx">assert</span><span class="p">.</span><span class="nx">Equal</span><span class="p">(</span><span class="nx">t</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;192.0.2.0&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">host</span><span class="p">)</span>
<span class="nx">assert</span><span class="p">.</span><span class="nx">Equal</span><span class="p">(</span><span class="nx">t</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;8000&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">port</span><span class="p">)</span>

<span class="nx">host</span><span class="p">,</span><span class="w"> </span><span class="nx">port</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">net</span><span class="p">.</span><span class="nx">SplitHostPort</span><span class="p">(</span><span class="s">&quot;192.0.2.0:http&quot;</span><span class="p">)</span>
<span class="nx">require</span><span class="p">.</span><span class="nx">NoError</span><span class="p">(</span><span class="nx">t</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
<span class="nx">assert</span><span class="p">.</span><span class="nx">Equal</span><span class="p">(</span><span class="nx">t</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;192.0.2.0&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">host</span><span class="p">)</span>
<span class="nx">assert</span><span class="p">.</span><span class="nx">Equal</span><span class="p">(</span><span class="nx">t</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;http&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">port</span><span class="p">)</span>

<span class="nx">host</span><span class="p">,</span><span class="w"> </span><span class="nx">port</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">net</span><span class="p">.</span><span class="nx">SplitHostPort</span><span class="p">(</span><span class="s">&quot;:8000&quot;</span><span class="p">)</span>
<span class="nx">require</span><span class="p">.</span><span class="nx">NoError</span><span class="p">(</span><span class="nx">t</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
<span class="nx">assert</span><span class="p">.</span><span class="nx">Equal</span><span class="p">(</span><span class="nx">t</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">host</span><span class="p">)</span>
<span class="nx">assert</span><span class="p">.</span><span class="nx">Equal</span><span class="p">(</span><span class="nx">t</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;8000&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">port</span><span class="p">)</span>

<span class="nx">host</span><span class="p">,</span><span class="w"> </span><span class="nx">port</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">net</span><span class="p">.</span><span class="nx">SplitHostPort</span><span class="p">(</span><span class="s">&quot;1:8&quot;</span><span class="p">)</span>
<span class="nx">require</span><span class="p">.</span><span class="nx">NoError</span><span class="p">(</span><span class="nx">t</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
<span class="nx">assert</span><span class="p">.</span><span class="nx">Equal</span><span class="p">(</span><span class="nx">t</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;1&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">host</span><span class="p">)</span>
<span class="nx">assert</span><span class="p">.</span><span class="nx">Equal</span><span class="p">(</span><span class="nx">t</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;8&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">port</span><span class="p">)</span>
</pre></div>
</div>
</td><td><div class="highlight-go notranslate"><div class="highlight"><pre><span></span><span class="c1">// func TestSplitHostPort(t *testing.T)</span>

<span class="nx">tests</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="p">[]</span><span class="kd">struct</span><span class="p">{</span>
<span class="w">  </span><span class="nx">give</span><span class="w">     </span><span class="kt">string</span>
<span class="w">  </span><span class="nx">wantHost</span><span class="w"> </span><span class="kt">string</span>
<span class="w">  </span><span class="nx">wantPort</span><span class="w"> </span><span class="kt">string</span>
<span class="p">}{</span>
<span class="w">  </span><span class="p">{</span>
<span class="w">    </span><span class="nx">give</span><span class="p">:</span><span class="w">     </span><span class="s">&quot;192.0.2.0:8000&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nx">wantHost</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;192.0.2.0&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nx">wantPort</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;8000&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="p">{</span>
<span class="w">    </span><span class="nx">give</span><span class="p">:</span><span class="w">     </span><span class="s">&quot;192.0.2.0:http&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nx">wantHost</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;192.0.2.0&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nx">wantPort</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;http&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="p">{</span>
<span class="w">    </span><span class="nx">give</span><span class="p">:</span><span class="w">     </span><span class="s">&quot;:8000&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nx">wantHost</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nx">wantPort</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;8000&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="p">{</span>
<span class="w">    </span><span class="nx">give</span><span class="p">:</span><span class="w">     </span><span class="s">&quot;1:8&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nx">wantHost</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;1&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nx">wantPort</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;8&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="p">},</span>
<span class="p">}</span>

<span class="k">for</span><span class="w"> </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">tt</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="k">range</span><span class="w"> </span><span class="nx">tests</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">t</span><span class="p">.</span><span class="nx">Run</span><span class="p">(</span><span class="nx">tt</span><span class="p">.</span><span class="nx">give</span><span class="p">,</span><span class="w"> </span><span class="kd">func</span><span class="p">(</span><span class="nx">t</span><span class="w"> </span><span class="o">*</span><span class="nx">testing</span><span class="p">.</span><span class="nx">T</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">host</span><span class="p">,</span><span class="w"> </span><span class="nx">port</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">net</span><span class="p">.</span><span class="nx">SplitHostPort</span><span class="p">(</span><span class="nx">tt</span><span class="p">.</span><span class="nx">give</span><span class="p">)</span>
<span class="w">    </span><span class="nx">require</span><span class="p">.</span><span class="nx">NoError</span><span class="p">(</span><span class="nx">t</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
<span class="w">    </span><span class="nx">assert</span><span class="p">.</span><span class="nx">Equal</span><span class="p">(</span><span class="nx">t</span><span class="p">,</span><span class="w"> </span><span class="nx">tt</span><span class="p">.</span><span class="nx">wantHost</span><span class="p">,</span><span class="w"> </span><span class="nx">host</span><span class="p">)</span>
<span class="w">    </span><span class="nx">assert</span><span class="p">.</span><span class="nx">Equal</span><span class="p">(</span><span class="nx">t</span><span class="p">,</span><span class="w"> </span><span class="nx">tt</span><span class="p">.</span><span class="nx">wantPort</span><span class="p">,</span><span class="w"> </span><span class="nx">port</span><span class="p">)</span>
<span class="w">  </span><span class="p">})</span>
<span class="p">}</span>
</pre></div>
</div>
</td></tr>
</tbody></table><p>Test tables make it easier to add context to error messages, reduce duplicate
logic, and add new test cases.</p>
<p>We follow the convention that the slice of structs is referred to as <code class="docutils literal notranslate"><span class="pre">tests</span></code>
and each test case <code class="docutils literal notranslate"><span class="pre">tt</span></code>. Further, we encourage explicating the input and output
values for each test case with <code class="docutils literal notranslate"><span class="pre">give</span></code> and <code class="docutils literal notranslate"><span class="pre">want</span></code> prefixes.</p>
<div class="highlight-go notranslate"><div class="highlight"><pre><span></span><span class="nx">tests</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="p">[]</span><span class="kd">struct</span><span class="p">{</span>
<span class="w">  </span><span class="nx">give</span><span class="w">     </span><span class="kt">string</span>
<span class="w">  </span><span class="nx">wantHost</span><span class="w"> </span><span class="kt">string</span>
<span class="w">  </span><span class="nx">wantPort</span><span class="w"> </span><span class="kt">string</span>
<span class="p">}{</span>
<span class="w">  </span><span class="c1">// ...</span>
<span class="p">}</span>

<span class="k">for</span><span class="w"> </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">tt</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="k">range</span><span class="w"> </span><span class="nx">tests</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="c1">// ...</span>
<span class="p">}</span>
</pre></div>
</div>
<section id="avoid-unnecessary-complexity-in-table-tests">
<h2><span class="section-number">3.2.56.1. </span>Avoid Unnecessary Complexity in Table Tests<a class="headerlink" href="#avoid-unnecessary-complexity-in-table-tests" title="Permalink to this heading"></a></h2>
<p>Table tests can be difficult to read and maintain if the subtests contain conditional
assertions or other branching logic. Table tests should <strong>NOT</strong> be used whenever
there needs to be complex or conditional logic inside subtests (i.e. complex logic inside the <code class="docutils literal notranslate"><span class="pre">for</span></code> loop).</p>
<p>Large, complex table tests harm readability and maintainability because test readers may
have difficulty debugging test failures that occur.</p>
<p>Table tests like this should be split into either multiple test tables or multiple
individual <code class="docutils literal notranslate"><span class="pre">Test...</span></code> functions.</p>
<p>Some ideals to aim for are:</p>
<ul class="simple">
<li><p>Focus on the narrowest unit of behavior</p></li>
<li><p>Minimize “test depth”, and avoid conditional assertions (see below)</p></li>
<li><p>Ensure that all table fields are used in all tests</p></li>
<li><p>Ensure that all test logic runs for all table cases</p></li>
</ul>
<p>In this context, “test depth” means “within a given test, the number of
successive assertions that require previous assertions to hold” (similar
to cyclomatic complexity).
Having “shallower” tests means that there are fewer relationships between
assertions and, more importantly, that those assertions are less likely
to be conditional by default.</p>
<p>Concretely, table tests can become confusing and difficult to read if they use multiple branching
pathways (e.g. <code class="docutils literal notranslate"><span class="pre">shouldError</span></code>, <code class="docutils literal notranslate"><span class="pre">expectCall</span></code>, etc.), use many <code class="docutils literal notranslate"><span class="pre">if</span></code> statements for
specific mock expectations (e.g. <code class="docutils literal notranslate"><span class="pre">shouldCallFoo</span></code>), or place functions inside the
table (e.g. <code class="docutils literal notranslate"><span class="pre">setupMocks</span> <span class="pre">func(*FooMock)</span></code>).</p>
<p>However, when testing behavior that only
changes based on changed input, it may be preferable to group similar cases
together in a table test to better illustrate how behavior changes across all inputs,
rather than splitting otherwise comparable units into separate tests
and making them harder to compare and contrast.</p>
<p>If the test body is short and straightforward,
it’s acceptable to have a single branching pathway for success versus failure cases
with a table field like <code class="docutils literal notranslate"><span class="pre">shouldErr</span></code> to specify error expectations.</p>
<table>
<thead><tr><th>Bad</th><th>Good</th></tr></thead>
<tbody>
<tr><td><div class="highlight-go notranslate"><div class="highlight"><pre><span></span><span class="kd">func</span><span class="w"> </span><span class="nx">TestComplicatedTable</span><span class="p">(</span><span class="nx">t</span><span class="w"> </span><span class="o">*</span><span class="nx">testing</span><span class="p">.</span><span class="nx">T</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">tests</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="p">[]</span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">give</span><span class="w">          </span><span class="kt">string</span>
<span class="w">    </span><span class="nx">want</span><span class="w">          </span><span class="kt">string</span>
<span class="w">    </span><span class="nx">wantErr</span><span class="w">       </span><span class="kt">error</span>
<span class="w">    </span><span class="nx">shouldCallX</span><span class="w">   </span><span class="kt">bool</span>
<span class="w">    </span><span class="nx">shouldCallY</span><span class="w">   </span><span class="kt">bool</span>
<span class="w">    </span><span class="nx">giveXResponse</span><span class="w"> </span><span class="kt">string</span>
<span class="w">    </span><span class="nx">giveXErr</span><span class="w">      </span><span class="kt">error</span>
<span class="w">    </span><span class="nx">giveYResponse</span><span class="w"> </span><span class="kt">string</span>
<span class="w">    </span><span class="nx">giveYErr</span><span class="w">      </span><span class="kt">error</span>
<span class="w">  </span><span class="p">}{</span>
<span class="w">    </span><span class="c1">// ...</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="k">for</span><span class="w"> </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">tt</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="k">range</span><span class="w"> </span><span class="nx">tests</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">t</span><span class="p">.</span><span class="nx">Run</span><span class="p">(</span><span class="nx">tt</span><span class="p">.</span><span class="nx">give</span><span class="p">,</span><span class="w"> </span><span class="kd">func</span><span class="p">(</span><span class="nx">t</span><span class="w"> </span><span class="o">*</span><span class="nx">testing</span><span class="p">.</span><span class="nx">T</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="c1">// setup mocks</span>
<span class="w">      </span><span class="nx">ctrl</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">gomock</span><span class="p">.</span><span class="nx">NewController</span><span class="p">(</span><span class="nx">t</span><span class="p">)</span>
<span class="w">      </span><span class="nx">xMock</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">xmock</span><span class="p">.</span><span class="nx">NewMockX</span><span class="p">(</span><span class="nx">ctrl</span><span class="p">)</span>
<span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="nx">tt</span><span class="p">.</span><span class="nx">shouldCallX</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">xMock</span><span class="p">.</span><span class="nx">EXPECT</span><span class="p">().</span><span class="nx">Call</span><span class="p">().</span><span class="nx">Return</span><span class="p">(</span>
<span class="w">          </span><span class="nx">tt</span><span class="p">.</span><span class="nx">giveXResponse</span><span class="p">,</span><span class="w"> </span><span class="nx">tt</span><span class="p">.</span><span class="nx">giveXErr</span><span class="p">,</span>
<span class="w">        </span><span class="p">)</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">yMock</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">ymock</span><span class="p">.</span><span class="nx">NewMockY</span><span class="p">(</span><span class="nx">ctrl</span><span class="p">)</span>
<span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="nx">tt</span><span class="p">.</span><span class="nx">shouldCallY</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">yMock</span><span class="p">.</span><span class="nx">EXPECT</span><span class="p">().</span><span class="nx">Call</span><span class="p">().</span><span class="nx">Return</span><span class="p">(</span>
<span class="w">          </span><span class="nx">tt</span><span class="p">.</span><span class="nx">giveYResponse</span><span class="p">,</span><span class="w"> </span><span class="nx">tt</span><span class="p">.</span><span class="nx">giveYErr</span><span class="p">,</span>
<span class="w">        </span><span class="p">)</span>
<span class="w">      </span><span class="p">}</span>

<span class="w">      </span><span class="nx">got</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">DoComplexThing</span><span class="p">(</span><span class="nx">tt</span><span class="p">.</span><span class="nx">give</span><span class="p">,</span><span class="w"> </span><span class="nx">xMock</span><span class="p">,</span><span class="w"> </span><span class="nx">yMock</span><span class="p">)</span>

<span class="w">      </span><span class="c1">// verify results</span>
<span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="nx">tt</span><span class="p">.</span><span class="nx">wantErr</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">require</span><span class="p">.</span><span class="nx">EqualError</span><span class="p">(</span><span class="nx">t</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">,</span><span class="w"> </span><span class="nx">tt</span><span class="p">.</span><span class="nx">wantErr</span><span class="p">)</span>
<span class="w">        </span><span class="k">return</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">require</span><span class="p">.</span><span class="nx">NoError</span><span class="p">(</span><span class="nx">t</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
<span class="w">      </span><span class="nx">assert</span><span class="p">.</span><span class="nx">Equal</span><span class="p">(</span><span class="nx">t</span><span class="p">,</span><span class="w"> </span><span class="nx">want</span><span class="p">,</span><span class="w"> </span><span class="nx">got</span><span class="p">)</span>
<span class="w">    </span><span class="p">})</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</td><td><div class="highlight-go notranslate"><div class="highlight"><pre><span></span><span class="kd">func</span><span class="w"> </span><span class="nx">TestShouldCallX</span><span class="p">(</span><span class="nx">t</span><span class="w"> </span><span class="o">*</span><span class="nx">testing</span><span class="p">.</span><span class="nx">T</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="c1">// setup mocks</span>
<span class="w">  </span><span class="nx">ctrl</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">gomock</span><span class="p">.</span><span class="nx">NewController</span><span class="p">(</span><span class="nx">t</span><span class="p">)</span>
<span class="w">  </span><span class="nx">xMock</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">xmock</span><span class="p">.</span><span class="nx">NewMockX</span><span class="p">(</span><span class="nx">ctrl</span><span class="p">)</span>
<span class="w">  </span><span class="nx">xMock</span><span class="p">.</span><span class="nx">EXPECT</span><span class="p">().</span><span class="nx">Call</span><span class="p">().</span><span class="nx">Return</span><span class="p">(</span><span class="s">&quot;XResponse&quot;</span><span class="p">,</span><span class="w"> </span><span class="kc">nil</span><span class="p">)</span>

<span class="w">  </span><span class="nx">yMock</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">ymock</span><span class="p">.</span><span class="nx">NewMockY</span><span class="p">(</span><span class="nx">ctrl</span><span class="p">)</span>

<span class="w">  </span><span class="nx">got</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">DoComplexThing</span><span class="p">(</span><span class="s">&quot;inputX&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">xMock</span><span class="p">,</span><span class="w"> </span><span class="nx">yMock</span><span class="p">)</span>

<span class="w">  </span><span class="nx">require</span><span class="p">.</span><span class="nx">NoError</span><span class="p">(</span><span class="nx">t</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
<span class="w">  </span><span class="nx">assert</span><span class="p">.</span><span class="nx">Equal</span><span class="p">(</span><span class="nx">t</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;want&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">got</span><span class="p">)</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="nx">TestShouldCallYAndFail</span><span class="p">(</span><span class="nx">t</span><span class="w"> </span><span class="o">*</span><span class="nx">testing</span><span class="p">.</span><span class="nx">T</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="c1">// setup mocks</span>
<span class="w">  </span><span class="nx">ctrl</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">gomock</span><span class="p">.</span><span class="nx">NewController</span><span class="p">(</span><span class="nx">t</span><span class="p">)</span>
<span class="w">  </span><span class="nx">xMock</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">xmock</span><span class="p">.</span><span class="nx">NewMockX</span><span class="p">(</span><span class="nx">ctrl</span><span class="p">)</span>

<span class="w">  </span><span class="nx">yMock</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">ymock</span><span class="p">.</span><span class="nx">NewMockY</span><span class="p">(</span><span class="nx">ctrl</span><span class="p">)</span>
<span class="w">  </span><span class="nx">yMock</span><span class="p">.</span><span class="nx">EXPECT</span><span class="p">().</span><span class="nx">Call</span><span class="p">().</span><span class="nx">Return</span><span class="p">(</span><span class="s">&quot;YResponse&quot;</span><span class="p">,</span><span class="w"> </span><span class="kc">nil</span><span class="p">)</span>

<span class="w">  </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">DoComplexThing</span><span class="p">(</span><span class="s">&quot;inputY&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">xMock</span><span class="p">,</span><span class="w"> </span><span class="nx">yMock</span><span class="p">)</span>
<span class="w">  </span><span class="nx">assert</span><span class="p">.</span><span class="nx">EqualError</span><span class="p">(</span><span class="nx">t</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Y failed&quot;</span><span class="p">)</span>
<span class="p">}</span>
</pre></div>
</div>
</td></tr>
</tbody></table><p>This complexity makes it more difficult to change, understand, and prove the
correctness of the test.</p>
<p>While there are no strict guidelines, readability and maintainability should
always be top-of-mind when deciding between Table Tests versus separate tests
for multiple inputs/outputs to a system.</p>
</section>
<section id="parallel-tests">
<h2><span class="section-number">3.2.56.2. </span>Parallel Tests<a class="headerlink" href="#parallel-tests" title="Permalink to this heading"></a></h2>
<p>Parallel tests, like some specialized loops (for example, those that spawn
goroutines or capture references as part of the loop body),
must take care to explicitly assign loop variables within the loop’s scope to
ensure that they hold the expected values.</p>
<div class="highlight-go notranslate"><div class="highlight"><pre><span></span><span class="nx">tests</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="p">[]</span><span class="kd">struct</span><span class="p">{</span>
<span class="w">  </span><span class="nx">give</span><span class="w"> </span><span class="kt">string</span>
<span class="w">  </span><span class="c1">// ...</span>
<span class="p">}{</span>
<span class="w">  </span><span class="c1">// ...</span>
<span class="p">}</span>

<span class="k">for</span><span class="w"> </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">tt</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="k">range</span><span class="w"> </span><span class="nx">tests</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">tt</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">tt</span><span class="w"> </span><span class="c1">// for t.Parallel</span>
<span class="w">  </span><span class="nx">t</span><span class="p">.</span><span class="nx">Run</span><span class="p">(</span><span class="nx">tt</span><span class="p">.</span><span class="nx">give</span><span class="p">,</span><span class="w"> </span><span class="kd">func</span><span class="p">(</span><span class="nx">t</span><span class="w"> </span><span class="o">*</span><span class="nx">testing</span><span class="p">.</span><span class="nx">T</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">t</span><span class="p">.</span><span class="nx">Parallel</span><span class="p">()</span>
<span class="w">    </span><span class="c1">// ...</span>
<span class="w">  </span><span class="p">})</span>
<span class="p">}</span>
</pre></div>
</div>
<p>In the example above, we must declare a <code class="docutils literal notranslate"><span class="pre">tt</span></code> variable scoped to the loop
iteration because of the use of <code class="docutils literal notranslate"><span class="pre">t.Parallel()</span></code> below.
If we do not do that, most or all tests will receive an unexpected value for
<code class="docutils literal notranslate"><span class="pre">tt</span></code>, or a value that changes as they’re running.</p>
<!-- TODO: Explain how to use _test packages. --></section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="页脚">
        <a href="struct-zero.html" class="btn btn-neutral float-left" title="3.2.55. Use var for Zero Value Structs" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> 上一页</a>
        <a href="time.html" class="btn btn-neutral float-right" title="3.2.57. Use &#34;time&#34; to handle time" accesskey="n" rel="next">下一页 <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; 版权所有 2024.</p>
  </div>

  利用 <a href="https://www.sphinx-doc.org/">Sphinx</a> 构建，使用的 
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">主题</a>
    由 <a href="https://readthedocs.org">Read the Docs</a> 开发.
  
<div class="view_counter">
      <img class="img_view_counter" src="https://s01.flagcounter.com/count2/m02K/bg_FFFFFF/txt_F77B1B/border_CCCCCC/columns_3/maxflags_6/viewers_3/labels_1/pageviews_0/flags_0/percent_0/" alt="View Counter" border="0" />
</div>


</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>
<div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="版本">
    <span class="rst-current-version" data-toggle="rst-current-version">
        <span class="fa fa-book"> Read the Docs</span>
        v: latest
        <span class="fa fa-caret-down"></span>
    </span>
    <div class="rst-other-versions">
        <dl>
            <dt>版本</dt>
            <dd><a href="#">latest</a></dd>
        </dl>
    </div>
</div>

</body>
</html>